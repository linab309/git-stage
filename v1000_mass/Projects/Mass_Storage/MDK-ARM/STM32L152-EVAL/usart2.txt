; generated by Component: ARM Compiler 5.04 update 1 (build 49) Tool: ArmCC [5040049]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\stm32l152-eval\usart2.o --asm_dir=.\STM32L152-EVAL\ --list_dir=.\STM32L152-EVAL\ --depend=.\stm32l152-eval\usart2.d --cpu=Cortex-M3 --apcs=interwork -O3 -I..\inc -I..\..\..\Libraries\CMSIS\Device\ST\STM32L1xx\Include -I..\..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\..\Libraries\STM32L1xx_StdPeriph_Driver\inc -I..\..\..\Utilities\STM32_EVAL -I..\..\..\Utilities\STM32_EVAL\Common -I..\..\..\Utilities\STM32_EVAL\STM32L152_EVAL -I..\src\user -I..\src\user\include -I..\src\SYSTEM\delay -I..\src\SYSTEM\sys -I..\src\SYSTEM\usart -I..\src\HARDWARE\ADC -I..\src\HARDWARE\BMP -I..\src\HARDWARE\DMA -I..\src\HARDWARE\FLASH -I..\src\HARDWARE\GPS -I..\src\HARDWARE\KEY -I..\src\HARDWARE\PWM -I..\src\HARDWARE\RTC -I..\src\HARDWARE\SPI -I..\src\HARDWARE\USART2 -I..\src\HARDWARE\TIMER -I..\src\EX -I..\src\USMART -I..\..\..\Libraries\CMSIS\Include -I..\src\ff11a\src -I..\src\ff11a\src\option -I..\src\HARDWARE\LED -I..\src\HARDWARE\OLED -I..\src\ff11a\src -I..\src\ff11a\src\option -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\4.1.0\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32L1xx -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32L1XX_MD -DUSE_STM32L152_EVAL ..\src\HARDWARE\USART2\usart2.c]
                          THUMB

                          AREA ||i.TIM4_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM4_IRQHandler PROC
;;;147    //¶¨Ê±Æ÷4ÖÐ¶Ï·þÎñ³ÌÐò		    
;;;148    void TIM4_IRQHandler(void)
000000  4808              LDR      r0,|L1.36|
;;;149    { 	
;;;150    	if(TIM4->SR&0X01)//ÊÇ¸üÐÂÖÐ¶Ï
000002  8801              LDRH     r1,[r0,#0]
000004  07c9              LSLS     r1,r1,#31
000006  d00b              BEQ      |L1.32|
;;;151    	{	 			   
;;;152    		USART2_RX_STA|=1<<15;	//±ê¼Ç½ÓÊÕÍê³É
000008  4907              LDR      r1,|L1.40|
00000a  880a              LDRH     r2,[r1,#0]  ; USART2_RX_STA
00000c  f4424200          ORR      r2,r2,#0x8000
000010  800a              STRH     r2,[r1,#0]
;;;153    		TIM4->SR&=~(1<<0);		//Çå³ýÖÐ¶Ï±êÖ¾Î»		   
000012  8801              LDRH     r1,[r0,#0]
000014  f0210101          BIC      r1,r1,#1
000018  8001              STRH     r1,[r0,#0]
;;;154    		TIM4_Set(0);			//¹Ø±ÕTIM4  
00001a  2000              MOVS     r0,#0
00001c  f7ffbffe          B.W      TIM4_Set
                  |L1.32|
;;;155    	}	    
;;;156    }
000020  4770              BX       lr
;;;157    //ÉèÖÃTIM4µÄ¿ª¹Ø
                          ENDP

000022  0000              DCW      0x0000
                  |L1.36|
                          DCD      0x40000810
                  |L1.40|
                          DCD      ||.data||

                          AREA ||i.TIM4_Init||, CODE, READONLY, ALIGN=2

                  TIM4_Init PROC
;;;170    //psc£ºÊ±ÖÓÔ¤·ÖÆµÊý		 
;;;171    void TIM4_Init(u16 arr,u16 psc)
000000  4a0d              LDR      r2,|L2.56|
;;;172    {
;;;173    	RCC->APB1ENR|=1<<2;	//TIM4Ê±ÖÓÊ¹ÄÜ    
000002  6813              LDR      r3,[r2,#0]
000004  f0430304          ORR      r3,r3,#4
000008  6013              STR      r3,[r2,#0]
;;;174     	TIM4->ARR=arr;  	//Éè¶¨¼ÆÊýÆ÷×Ô¶¯ÖØ×°Öµ   
00000a  4a0c              LDR      r2,|L2.60|
00000c  6010              STR      r0,[r2,#0]
;;;175    	TIM4->PSC=psc;  	//Ô¤·ÖÆµÆ÷
00000e  1f10              SUBS     r0,r2,#4
000010  8001              STRH     r1,[r0,#0]
;;;176     	TIM4->DIER|=1<<0;   //ÔÊÐí¸üÐÂÖÐ¶Ï				
000012  480a              LDR      r0,|L2.60|
000014  3820              SUBS     r0,r0,#0x20
000016  8801              LDRH     r1,[r0,#0]
000018  f0410101          ORR      r1,r1,#1
00001c  8001              STRH     r1,[r0,#0]
;;;177     	TIM4->CR1|=0x01;  	//Ê¹ÄÜ¶¨Ê±Æ÷4	  	   
00001e  4807              LDR      r0,|L2.60|
000020  382c              SUBS     r0,r0,#0x2c
000022  8801              LDRH     r1,[r0,#0]
000024  f0410101          ORR      r1,r1,#1
000028  8001              STRH     r1,[r0,#0]
;;;178       	MY_NVIC_Init(1,3,TIM4_IRQn,2);//ÇÀÕ¼2£¬×ÓÓÅÏÈ¼¶3£¬×é2	ÔÚ2ÖÐÓÅÏÈ¼¶×îµÍ								 
00002a  2302              MOVS     r3,#2
00002c  221e              MOVS     r2,#0x1e
00002e  2103              MOVS     r1,#3
000030  2001              MOVS     r0,#1
000032  f7ffbffe          B.W      MY_NVIC_Init
;;;179    }
;;;180    #endif	
                          ENDP

000036  0000              DCW      0x0000
                  |L2.56|
                          DCD      0x40023824
                  |L2.60|
                          DCD      0x4000082c

                          AREA ||i.TIM4_Set||, CODE, READONLY, ALIGN=2

                  TIM4_Set PROC
;;;158    //sta:0£¬¹Ø±Õ;1,¿ªÆô;
;;;159    void TIM4_Set(u8 sta)
000000  4907              LDR      r1,|L3.32|
;;;160    {
000002  b138              CBZ      r0,|L3.20|
;;;161    	if(sta)
;;;162    	{
;;;163        	TIM4->CNT=0;         //¼ÆÊýÆ÷Çå¿Õ
000004  4a06              LDR      r2,|L3.32|
000006  2000              MOVS     r0,#0
000008  3224              ADDS     r2,r2,#0x24
00000a  6010              STR      r0,[r2,#0]
;;;164    		TIM4->CR1|=1<<0;     //Ê¹ÄÜ¶¨Ê±Æ÷4
00000c  8808              LDRH     r0,[r1,#0]
00000e  f0400001          ORR      r0,r0,#1
000012  e002              B        |L3.26|
                  |L3.20|
;;;165    	}else TIM4->CR1&=~(1<<0);//¹Ø±Õ¶¨Ê±Æ÷4	   
000014  8808              LDRH     r0,[r1,#0]
000016  f0200001          BIC      r0,r0,#1
                  |L3.26|
00001a  8008              STRH     r0,[r1,#0]            ;164
;;;166    }
00001c  4770              BX       lr
;;;167    //Í¨ÓÃ¶¨Ê±Æ÷ÖÐ¶Ï³õÊ¼»¯
                          ENDP

00001e  0000              DCW      0x0000
                  |L3.32|
                          DCD      0x40000800

                          AREA ||i.USART2_IRQHandler||, CODE, READONLY, ALIGN=2

                  USART2_IRQHandler PROC
;;;33     u16 USART2_RX_STA=0;   	 
;;;34     void USART2_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;35     {
;;;36     	u8 res;	    
;;;37     	//if(USART2->SR&(1<<5))//½ÓÊÕµ½Êý¾Ý
;;;38     	 if (USART_GetITStatus(USART2, USART_IT_RXNE) == SET)	
000002  f2405125          MOV      r1,#0x525
000006  480f              LDR      r0,|L4.68|
000008  f7fffffe          BL       USART_GetITStatus
00000c  2801              CMP      r0,#1
00000e  d114              BNE      |L4.58|
;;;39     	{	 
;;;40     		res=USART2->DR; 			 
000010  480c              LDR      r0,|L4.68|
000012  1d00              ADDS     r0,r0,#4
000014  8800              LDRH     r0,[r0,#0]
;;;41     		if(USART2_RX_STA<USART2_MAX_RECV_LEN)		//»¹¿ÉÒÔ½ÓÊÕÊý¾Ý
000016  4b0c              LDR      r3,|L4.72|
000018  b2c4              UXTB     r4,r0                 ;40
00001a  8818              LDRH     r0,[r3,#0]  ; USART2_RX_STA
00001c  f5b07f48          CMP      r0,#0x320
000020  d20c              BCS      |L4.60|
;;;42     		{
;;;43     			TIM4->CNT=0;         					//¼ÆÊýÆ÷Çå¿Õ
000022  4a0a              LDR      r2,|L4.76|
000024  2100              MOVS     r1,#0
000026  6011              STR      r1,[r2,#0]
;;;44     			if(USART2_RX_STA==0)TIM4_Set(1);	 	//Ê¹ÄÜ¶¨Ê±Æ÷4µÄÖÐ¶Ï 
000028  b910              CBNZ     r0,|L4.48|
00002a  2001              MOVS     r0,#1
00002c  f7fffffe          BL       TIM4_Set
                  |L4.48|
;;;45     			USART2_RX_BUF[USART2_RX_STA++]=res;		//¼ÇÂ¼½ÓÊÕµ½µÄÖµ	 
000030  4907              LDR      r1,|L4.80|
000032  8818              LDRH     r0,[r3,#0]  ; USART2_RX_STA
000034  540c              STRB     r4,[r1,r0]
000036  1c40              ADDS     r0,r0,#1
                  |L4.56|
;;;46     		}else 
;;;47     		{
;;;48     			USART2_RX_STA|=1<<15;					//Ç¿ÖÆ±ê¼Ç½ÓÊÕÍê³É
000038  8018              STRH     r0,[r3,#0]
                  |L4.58|
;;;49     		} 
;;;50     	}  											 
;;;51     }   
00003a  bd10              POP      {r4,pc}
                  |L4.60|
00003c  f4404000          ORR      r0,r0,#0x8000         ;48
000040  e7fa              B        |L4.56|
;;;52     //³õÊ¼»¯IO ´®¿Ú2
                          ENDP

000042  0000              DCW      0x0000
                  |L4.68|
                          DCD      0x40004400
                  |L4.72|
                          DCD      ||.data||
                  |L4.76|
                          DCD      0x40000824
                  |L4.80|
                          DCD      ||area_number.8||

                          AREA ||i.USART2_Init||, CODE, READONLY, ALIGN=2

                  USART2_Init PROC
;;;54     //bound:²¨ÌØÂÊ	  
;;;55     void USART2_Init(u32 pclk1,u32 bound)
000000  b5f0              PUSH     {r4-r7,lr}
;;;56     {  	 
000002  460d              MOV      r5,r1
000004  4606              MOV      r6,r0
;;;57        GPIO_InitTypeDef  GPIO_InitStructure;
;;;58        USART_InitTypeDef USART_InitStructure;
;;;59     //NVIC_InitTypeDef NVIC_InitStructure;
;;;60     
;;;61     
;;;62     /* Enable GPIO clock */
;;;63         RCC_AHBPeriphClockCmd(RCC_AHBENR_GPIOAEN , ENABLE);
000006  2101              MOVS     r1,#1
000008  b087              SUB      sp,sp,#0x1c           ;56
00000a  4608              MOV      r0,r1
00000c  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;64     
;;;65     	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3;
000010  2008              MOVS     r0,#8
;;;66     	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000012  9004              STR      r0,[sp,#0x10]
000014  2002              MOVS     r0,#2
000016  f88d0014          STRB     r0,[sp,#0x14]
;;;67     	GPIO_InitStructure.GPIO_Speed  = GPIO_Speed_40MHz;
00001a  2003              MOVS     r0,#3
00001c  f88d0015          STRB     r0,[sp,#0x15]
;;;68     	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
000020  2400              MOVS     r4,#0
000022  f88d4016          STRB     r4,[sp,#0x16]
;;;69     	GPIO_InitStructure.GPIO_PuPd  = GPIO_PuPd_UP;
000026  2001              MOVS     r0,#1
;;;70     	GPIO_Init(GPIOA, &GPIO_InitStructure);
000028  4f22              LDR      r7,|L5.180|
00002a  f88d0017          STRB     r0,[sp,#0x17]         ;69
00002e  a904              ADD      r1,sp,#0x10
000030  4638              MOV      r0,r7
000032  f7fffffe          BL       GPIO_Init
;;;71     	/* Connect rx to GPIO_AF_USART2 */
;;;72        //    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
;;;73     	//GPIO_Init(GPIOA, &GPIO_InitStructure);
;;;74     
;;;75     /* Enable USART clock */
;;;76     	RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART2, ENABLE);
000036  2101              MOVS     r1,#1
000038  0448              LSLS     r0,r1,#17
00003a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;77     
;;;78     //	RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART2, ENABLE);
;;;79     
;;;80     	GPIO_PinAFConfig(GPIOA, GPIO_PinSource3, GPIO_AF_USART2); 
00003e  2207              MOVS     r2,#7
000040  2103              MOVS     r1,#3
000042  4638              MOV      r0,r7
000044  f7fffffe          BL       GPIO_PinAFConfig
;;;81     
;;;82     //	GPIO_PinAFConfig(GPIOA, GPIO_PinSource2, GPIO_AF_USART2); 
;;;83     
;;;84     	   
;;;85     
;;;86     
;;;87     	USART_InitStructure.USART_BaudRate = bound;
;;;88     	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
000048  9500              STR      r5,[sp,#0]
;;;89     	USART_InitStructure.USART_StopBits = USART_StopBits_1;
;;;90     	USART_InitStructure.USART_Parity = USART_Parity_No;
00004a  f8ad4008          STRH     r4,[sp,#8]
;;;91     	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
;;;92     	USART_InitStructure.USART_Mode = USART_Mode_Rx ;
00004e  2004              MOVS     r0,#4
;;;93     	USART_Init(USART2, &USART_InitStructure);
000050  4d19              LDR      r5,|L5.184|
000052  f8ad4004          STRH     r4,[sp,#4]            ;88
000056  f8ad000a          STRH     r0,[sp,#0xa]          ;92
00005a  f8ad4006          STRH     r4,[sp,#6]            ;89
00005e  f8ad400c          STRH     r4,[sp,#0xc]          ;91
000062  4669              MOV      r1,sp
000064  4628              MOV      r0,r5
000066  f7fffffe          BL       USART_Init
;;;94     
;;;95     
;;;96     
;;;97     	USART2->CR1|=1<<8;    	//PEÖÐ¶ÏÊ¹ÄÜ
00006a  4813              LDR      r0,|L5.184|
00006c  300c              ADDS     r0,r0,#0xc
00006e  8801              LDRH     r1,[r0,#0]
000070  f4417180          ORR      r1,r1,#0x100
000074  8001              STRH     r1,[r0,#0]
;;;98     	USART2->CR1|=1<<5;    	//½ÓÊÕ»º³åÇø·Ç¿ÕÖÐ¶ÏÊ¹ÄÜ	    	
000076  8801              LDRH     r1,[r0,#0]
000078  f0410120          ORR      r1,r1,#0x20
00007c  8001              STRH     r1,[r0,#0]
;;;99     	MY_NVIC_Init(2,3,USART2_IRQn,2);//×é2£¬×îµÍÓÅÏÈ¼¶ 
00007e  2302              MOVS     r3,#2
000080  2226              MOVS     r2,#0x26
000082  2103              MOVS     r1,#3
000084  4618              MOV      r0,r3
000086  f7fffffe          BL       MY_NVIC_Init
;;;100    
;;;101    //      USART_ITConfig(USART2, USART_IT_RXNE, ENABLE);
;;;102    
;;;103    	USART_Cmd(USART2, ENABLE);
00008a  2101              MOVS     r1,#1
00008c  4628              MOV      r0,r5
00008e  f7fffffe          BL       USART_Cmd
;;;104    	//UART_DMA_Config(DMA1_Channel7,(u32)&USART2->DR,(u32)USART2_TX_BUF);//DMA1Í¨µÀ7,ÍâÉèÎª´®¿Ú2,´æ´¢Æ÷ÎªUSART2_TX_BUF 
;;;105    
;;;106          if(pclk1 == 16)
000092  2e10              CMP      r6,#0x10
000094  d00b              BEQ      |L5.174|
;;;107    	  TIM4_Init(99,1599);		//10msÖÐ¶Ï
;;;108          else
;;;109    	  TIM4_Init(99,3199);		//10msÖÐ¶
000096  f640417f          MOV      r1,#0xc7f
                  |L5.154|
00009a  2063              MOVS     r0,#0x63
00009c  f7fffffe          BL       TIM4_Init
;;;110    	  
;;;111    	USART2_RX_STA=0;		//ÇåÁã
0000a0  4806              LDR      r0,|L5.188|
0000a2  8004              STRH     r4,[r0,#0]
;;;112    	TIM4_Set(0);			//¹Ø±Õ¶¨Ê±Æ÷4
0000a4  2000              MOVS     r0,#0
0000a6  f7fffffe          BL       TIM4_Set
;;;113    //	UART_DMA_Config(DMA1_Channel7,(u32)&USART2->DR,(u32)USART2_TX_BUF);//DMA1Í¨µÀ7,ÍâÉèÎª´®¿Ú2,´æ´¢Æ÷ÎªUSART2_TX_BUF 
;;;114    #if 0  
;;;115       	   
;;;116    	//²¨ÌØÂÊÉèÖÃ
;;;117     	USART2->BRR=(pclk1*1000000)/(bound);// ²¨ÌØÂÊÉèÖÃ	 
;;;118    	USART2->CR1|=0X200C;  	//1Î»Í£Ö¹,ÎÞÐ£ÑéÎ».
;;;119    	USART2->CR3=1<<7;   	//Ê¹ÄÜ´®¿Ú2µÄDMA·¢ËÍ
;;;120    //	UART_DMA_Config(DMA1_Channel7,(u32)&USART2->DR,(u32)USART2_TX_BUF);//DMA1Í¨µÀ7,ÍâÉèÎª´®¿Ú2,´æ´¢Æ÷ÎªUSART2_TX_BUF 
;;;121    #ifdef USART2_RX_EN		  	//Èç¹ûÊ¹ÄÜÁË½ÓÊÕ
;;;122    	//Ê¹ÄÜ½ÓÊÕÖÐ¶Ï
;;;123    	USART2->CR1|=1<<8;    	//PEÖÐ¶ÏÊ¹ÄÜ
;;;124    	USART2->CR1|=1<<5;    	//½ÓÊÕ»º³åÇø·Ç¿ÕÖÐ¶ÏÊ¹ÄÜ	    	
;;;125    	MY_NVIC_Init(2,3,USART2_IRQn,2);//×é2£¬×îµÍÓÅÏÈ¼¶ 
;;;126    	TIM4_Init(99,1599);		//10msÖÐ¶Ï
;;;127    	USART2_RX_STA=0;		//ÇåÁã
;;;128    	TIM4_Set(0);			//¹Ø±Õ¶¨Ê±Æ÷4
;;;129    #endif		
;;;130    #endif
;;;131    }
0000aa  b007              ADD      sp,sp,#0x1c
0000ac  bdf0              POP      {r4-r7,pc}
                  |L5.174|
0000ae  f240613f          MOV      r1,#0x63f             ;107
0000b2  e7f2              B        |L5.154|
;;;132    
                          ENDP

                  |L5.180|
                          DCD      0x40020000
                  |L5.184|
                          DCD      0x40004400
                  |L5.188|
                          DCD      ||.data||

                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  USART2_TX_BUF
                          %        200

                          AREA ||area_number.8||, DATA, NOINIT, ALIGN=0

                          EXPORTAS ||area_number.8||, ||.bss||
                  USART2_RX_BUF
                          %        800

                          AREA ||.data||, DATA, ALIGN=1

                  USART2_RX_STA
000000  0000              DCW      0x0000

;*** Start embedded assembler ***

#line 1 "..\\src\\HARDWARE\\USART2\\usart2.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___8_usart2_c_ac654cdf____REV16|
#line 114 "..\\..\\..\\Libraries\\CMSIS\\Include\\core_cmInstr.h"
|__asm___8_usart2_c_ac654cdf____REV16| PROC
#line 115

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___8_usart2_c_ac654cdf____REVSH|
#line 128
|__asm___8_usart2_c_ac654cdf____REVSH| PROC
#line 129

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
